-- //////////////////////////////////////////////////////////////
-- // ARCHIVO:			
-- //////////////////////////////////////////////////////////////
-- // BASE DE DATOS:	PYF18_Finanzas
-- // MODULO:			
-- // OPERACION:		LIBERACION / TABLA+CARGA 
-- ////////////////////////////////////////////////////////////// 

USE [PYF18_Finanzas_V9999_R0] 
GO

-- //////////////////////////////////////////////////////////////



-- //////////////////////////////////////////////////////////////


IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PRECIO_COSTO_PERFIL]') AND type in (N'U'))
	DELETE FROM [dbo].[PRECIO_COSTO_PERFIL]
GO





-- //////////////////////////////////////////////////////////////
-- // STORED PROCEDURE --> [PG_CI_PRECIO_COSTO_PERFIL]
-- //////////////////////////////////////////////////////////////

IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PG_CI_PRECIO_COSTO_PERFIL]') AND type in (N'P', N'PC'))
	DROP PROCEDURE [dbo].[PG_CI_PRECIO_COSTO_PERFIL]
GO


CREATE PROCEDURE [dbo].[PG_CI_PRECIO_COSTO_PERFIL]
	@PP_L_DEBUG					INT,
	@PP_K_SISTEMA_EXE			INT,
	@PP_K_USUARIO_ACCION		INT,
	@PP_K_PRECIO_COSTO_PERFIL	INT,
	-- ===========================	
	@PP_O_PRECIO_COSTO_PERFIL	INT,
	@PP_L_PRECIO_COSTO_PERFIL	INT,
	-- ===========================
	@PP_K_UNIDAD_OPERATIVA		INT,
	@PP_K_YYYY					INT,
	@PP_K_MM					INT,
	-- ===========================	
	@PP_PV_PRECIO_VENTA			DECIMAL(19,4),
	-- ===========================		
	@PP_MC						DECIMAL(19,4),
	@PP_FLETE					DECIMAL(19,4),
	@PP_CA						DECIMAL(19,4),
	@PP_APG						DECIMAL(19,4),
	@PP_MP_INB					DECIMAL(19,4),
	@PP_FG						DECIMAL(19,4),
	@PP_SMD						DECIMAL(19,4),
	@PP_SMP						DECIMAL(19,4),
	@PP_SMRU					DECIMAL(19,4),
	@PP_SMPT					DECIMAL(19,4),
	@PP_L_BORRADO				INT
AS

	INSERT INTO PRECIO_COSTO_PERFIL
		(	
			[K_PRECIO_COSTO_PERFIL],		
			[O_PRECIO_COSTO_PERFIL],		[L_PRECIO_COSTO_PERFIL],
			[K_UNIDAD_OPERATIVA], [K_YYYY], [K_MM],
			-- ===========================	
			[PV_PRECIO_VENTA],
			-- ===========================		
			[MC],	[FLETE],	[CA],							
			[APG],	[MP_INB],	[FG],
			[SMD], [SMP], [SMRU], [SMPT],
			[K_USUARIO_ALTA],	[F_ALTA],
			[K_USUARIO_CAMBIO],	[F_CAMBIO],
			[L_BORRADO]		)	
	VALUES	
		(	 
			@PP_K_PRECIO_COSTO_PERFIL,
			@PP_O_PRECIO_COSTO_PERFIL,			@PP_L_PRECIO_COSTO_PERFIL,
			@PP_K_UNIDAD_OPERATIVA,	@PP_K_YYYY, @PP_K_MM,
			-- ===========================	
			@PP_PV_PRECIO_VENTA,
			-- ===========================		
			@PP_MC,		@PP_FLETE,		@PP_CA,
			@PP_APG,	@PP_MP_INB,		@PP_FG,
			@PP_SMD, @PP_SMP, @PP_SMRU, @PP_SMPT,
			@PP_K_USUARIO_ACCION,		GETDATE(),
			@PP_K_USUARIO_ACCION,		GETDATE(),
			@PP_L_BORRADO	
		)

	-- ////////////////////////////////////////////////

	UPDATE	PRECIO_COSTO_PERFIL
	SET		[PC_PRECIO_COMPRA] = (		[PV_PRECIO_VENTA]
									-	[MC]	- [FLETE]	- [CA] 
									-	[APG]	- [MP_INB]	- [FG] 
									-	[SMD]	- [SMP]		- [SMRU]	- [SMPT]	)
	WHERE	K_PRECIO_COSTO_PERFIL=@PP_K_PRECIO_COSTO_PERFIL

	-- ////////////////////////////////////////////////
GO



-- /////////////////////////////////////////////////////////////////////
-- // CARGA INICIAL PRECIO_COSTO_PERFIL
-- /////////////////////////////////////////////////////////////////////


-- ===============================================
SET NOCOUNT ON
-- ===============================================


EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1013, 10, 1, 13, 2018, 3, 17.31, 2.29, 0.716, 0.543999999999998, 0.2717, 0.19, 0.28, 0.335999999999999, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1021, 20, 1, 21, 2018, 3, 17.31, 2.29, 0.716, 0.544000000000001, 0.2605, 0.19, 0.28, 0.336, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1020, 30, 1, 20, 2018, 3, 17.31, 2.29, 0.716, 0.544000000000001, 0.2103, 0.19, 0.28, 0.336, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1023, 40, 1, 23, 2018, 3, 17.31, 2.31, 0.716, 0.4736, 0.2462, 0.19, 0.28, 0.386399999999999, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1018, 50, 1, 18, 2018, 3, 17.31, 2.33, 0.716, 0.504, 0.1676, 0.19, 0.28, 0.336, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1024, 60, 1, 24, 2018, 3, 17.31, 2.31, 0.716, 0.473600000000004, 0.1635, 0.19, 0.28, 0.3864, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1025, 70, 1, 25, 2018, 3, 17.5, 2.33865355217778, 0.716, 0.495346447822216, 0.2223, 0.19, 0.28, 0.336000000000001, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1032, 80, 1, 32, 2018, 3, 15.22, 2.31, 0.716, 0.3136, 0, 0, 0, 0.856399999999999, 0, 0, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1026, 90, 1, 26, 2018, 3, 17.13, 2.3, 0.716, 0.527848275862068, 0.2758, 0.19, 0.28, 0.285599999999998, 0, 0, 0.646551724137931, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1029, 100, 1, 29, 2018, 3, 17.78, 2.47, 0.916, 0.509048275862068, 0.1666, 0.19, 0.28, 0.1344, 0, 0, 0.646551724137931, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1031, 110, 1, 31, 2018, 3, 17.78, 2.47, 0.916, 0.509048275862067, 0.1666, 0.19, 0.28, 0.1344, 0, 0, 0.646551724137931, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1028, 120, 1, 28, 2018, 3, 17.13, 2.32, 0.716, 0.491048275862073, 0.1685, 0.19, 0.28, 0.302399999999999, 0, 0, 0.646551724137931, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1027, 130, 1, 27, 2018, 3, 17.13, 2.47, 0.716, 0.873448275862067, 0.2631, 0.19, 0.28, 0, 0, 0, 0.646551724137931, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1030, 140, 1, 30, 2018, 3, 17.78, 2.39, 1.216, 0.498707500204839, 0.215, 0.19, 0.28, 0.259223534277919, 0, 0, 0.862068965517241, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1051, 150, 1, 51, 2018, 3, 17.78, 2.27, 1.216, 0.659531194682337, 0.226, 0.19, 0.28, 0.21839983980042, 0, 0, 0.862068965517241, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1053, 160, 1, 53, 2018, 3, 17.59, 2.42, 1.466, 0.442330627164244, 0.1945, 0.19, 0.28, 0.285600407318515, 0, 0, 0.862068965517241, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1054, 170, 1, 54, 2018, 3, 17.59, 2.38, 1.466, 0.482330627164241, 0.1945, 0.19, 0.28, 0.285600407318515, 0, 0, 0.862068965517241, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1055, 180, 1, 55, 2018, 3, 17.59, 2.34, 1.466, 0.522330627164241, 0.1945, 0.19, 0.28, 0.285600407318515, 0, 0, 0.862068965517241, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1056, 190, 1, 56, 2018, 3, 18.06, 2.31, 1.216, 0.569547831128648, 0.1845, 0.19, 0.28, 0.26838320335411, 0, 0, 0.862068965517241, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1057, 200, 1, 57, 2018, 3, 18.06, 2.31, 1.216, 0.569547831128649, 0.1845, 0.19, 0.28, 0.26838320335411, 0, 0, 0.862068965517241, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1070, 210, 1, 70, 2018, 3, 17.78, 2.31155, 1.216, 0.515164960988373, 0.16, 0.19, 0.28, 0.321216073494385, 0, 0, 0.862068965517241, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1068, 220, 1, 68, 2018, 3, 17.54, 2.42, 1.216, 0.304399592681484, 0, 0.19, 0.28, 0.285600407318516, 0, 0, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1059, 230, 1, 59, 2018, 3, 18.98, 2.0362, 2.056, 0.957, 0.1753, 0.19, 0.28, 0.016800000000001, 0, 0, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1060, 240, 1, 60, 2018, 3, 20, 2.3833, 2.056, 1.6299, 0.1753, 0.19, 0.28, 0.016800000000001, 0, 0, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1061, 250, 1, 61, 2018, 3, 19.63, 2.0365, 2.046, 0.746699999999999, 0.144, 0.19, 0.28, 0.226800000000001, 0, 0, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1071, 260, 1, 71, 2018, 3, 18.98, 2.0362, 2.056, 0.956999999999999, 0.1753, 0.19, 0.28, 0.016800000000001, 0, 0, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1062, 270, 1, 62, 2018, 3, 16.76, 2.3164, 1.616, 0.539376000000001, 0.1785, 0.19, 0.28, 0.154223999999999, 0, 0, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1063, 280, 1, 63, 2018, 3, 16.76, 2.3158, 1.616, 0.539976000000001, 0.1785, 0.19, 0.28, 0.154223999999999, 0, 0, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1064, 290, 1, 64, 2018, 3, 16.76, 2.2742, 1.476, 0.5258, 0.1871, 0.19, 0.28, 0.209999999999999, 0, 0, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1065, 300, 1, 65, 2018, 3, 16.76, 2.2742, 1.476, 0.5258, 0.1871, 0.19, 0.28, 0.209999999999999, 0, 0, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1066, 310, 1, 66, 2018, 3, 17.59, 1.91624, 0.716, 0.62336, 0.1989, 0.19, 0.28, 0.4704, 0, 0, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1082, 320, 1, 82, 2018, 3, 16.76, 2.3164, 1.616, 0.539376000000001, 0.1785, 0.19, 0.28, 0.154223999999999, 0, 0, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1003, 330, 1, 3, 2018, 3, 20.35, 2.2181, 0, 0.691499999999999, 0.3271, 0.19, 0.28, 0.2604, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1017, 340, 1, 17, 2018, 3, 20.35, 2.4876, 0.636, 0.36193470938914, 0.3634, 0.19, 0.28, 0.218399999999999, 0, 0, 0.362091933682113, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1083, 350, 1, 83, 2018, 3, 20.35, 2.5776, 0.686, 0.458000000000001, 0.3634, 0.19, 0.28, 0.1344, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1012, 360, 1, 12, 2018, 3, 19.81, 2.2781, 0.866, 0.698700000000001, 0, 0.19, 0.28, 0.1932, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1001, 370, 1, 1, 2018, 3, 20.35, 1.9681, 0.3998, 0.703107999999999, 0.3271, 0.19, 0.28, 0.498792, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1006, 380, 1, 6, 2018, 3, 20.35, 2.3076, 0.323, 0.579320000000001, 0.3271, 0.19, 0.28, 0.28308, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1011, 390, 1, 11, 2018, 3, 20.35, 2.3576, 0.416, 0.602400000000002, 0.2176, 0.19, 0.28, 0.209999999999998, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1005, 400, 1, 5, 2018, 3, 20.35, 1.9376, 0.3998, 1.027608, 0.2176, 0.19, 0.28, 0.204792, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1014, 410, 1, 14, 2018, 3, 20.35, 2.1876, 0.596, 0.6212, 0.3634, 0.19, 0.28, 0.3612, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1016, 420, 1, 16, 2018, 3, 20.35, 2.3576, 0.3999, 0.176099999999998, 0.2176, 0.19, 0.28, 0.6524, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1008, 430, 1, 8, 2018, 3, 20.35, 2.3576, 0.3999, 0.615923999999999, 0.2176, 0.19, 0.28, 0.196476000000001, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1004, 440, 1, 4, 2018, 3, 20.35, 2.4776, 0.596, 0.3312, 0.3634, 0.19, 0.28, 0.3612, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1002, 450, 1, 2, 2018, 3, 20.35, 2.9076, 0.636, 0.044000000000002, 0.3634, 0.19, 0.28, 0.218399999999999, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1015, 460, 1, 15, 2018, 3, 20.35, 2.7076, 0.636, 0.244000000000001, 0.3634, 0.19, 0.28, 0.218399999999999, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1009, 470, 1, 9, 2018, 3, 20.35, 2.5976, 0.636, 0.354000000000001, 0.3634, 0.19, 0.28, 0.218399999999999, 0, 0, 1, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1033, 480, 1, 33, 2018, 3, 20.28, 2.12, 0, 0.930000000000001, 0.1774, 0.1, 0.28, 0.318965517241378, 0.681034482758622, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1034, 490, 1, 34, 2018, 3, 20.28, 2.19, 0, 0.800000000000001, 0.1774, 0.1, 0.28, 0.370689655172413, 0.629310344827587, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1035, 500, 1, 35, 2018, 3, 20.28, 2.35, 0.326, 0.62, 0.1774, 0.1, 0.28, 0.387931034482758, 0.612068965517242, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1069, 510, 1, 69, 2018, 3, 20.28, 2.43, 0.416, 0.450000000000001, 0.1774, 0.1, 0.28, 0.46551724137931, 0.53448275862069, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1047, 520, 1, 47, 2018, 3, 17.78, 2.21, 0.726, 0.879999999999998, 0.2717, 0.1, 0.28, 0.28448275862069, 0.71551724137931, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1036, 530, 1, 36, 2018, 3, 20.19, 2.21, 0.426, 0.900000000000001, 0.2717, 0.1, 0.28, 0.267241379310344, 0.732758620689656, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1042, 540, 1, 42, 2018, 3, 20.19, 2.21, 0, 1.010001, 0.2717, 0.1, 0.28, 0.172412931034483, 0.827587068965517, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1049, 550, 1, 49, 2018, 3, 20.28, 2.21, 0.586, 0.760000000000002, 0.2717, 0.1, 0.28, 0.387931034482758, 0.612068965517242, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1073, 560, 1, 73, 2018, 3, 18.52, 2.20997141, 1.0397, 1.41032859, 0.2717, 0.1, 0.28, 0, 1, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1076, 570, 1, 76, 2018, 3, 18.43, 2.20997141, 1.416, 1.40402859, 0.2717, 0.1, 0.28, 0, 1, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1045, 580, 1, 45, 2018, 3, 20.19, 2.21, 0.806, 0.920000000000001, 0.2717, 0.1, 0.28, 0.25, 0.75, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1038, 590, 1, 38, 2018, 3, 19.91, 2.21, 0.89, 0.62, 0.27, 0.1, 0.28, 0.3, 0.7, 0.89, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1048, 600, 1, 48, 2018, 3, 17.78, 2.21, 0.6645, 1.0475, 0.2717, 0.1, 0.28, 0.140086206896553, 0.859913793103447, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1041, 610, 1, 41, 2018, 3, 20.19, 2.21, 0.4752, 0.962199999999999, 0.2717, 0.1, 0.28, 0.213620689655173, 0.786379310344827, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1040, 620, 1, 40, 2018, 3, 20.19, 2.21, 0.426, 0.839999999999998, 0.2717, 0.1, 0.28, 0.31896551724138, 0.68103448275862, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1039, 630, 1, 39, 2018, 3, 20.19, 2.21, 0.3046, 0.961399999999998, 0.2717, 0.1, 0.28, 0.214310344827587, 0.785689655172413, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1044, 640, 1, 44, 2018, 3, 20.19, 2.21, 0.3887, 0.8416, 0.2717, 0.1, 0.28, 0.317586206896551, 0.682413793103449, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1043, 650, 1, 43, 2018, 3, 20.19, 2.21, 0.286, 0.789999999999999, 0.2717, 0.1, 0.28, 0.362068965517242, 0.637931034482758, 1, 0, 0
EXECUTE [PG_CI_PRECIO_COSTO_PERFIL] 0, 0, 0, 1046, 660, 1, 46, 2018, 3, 20.19, 2.21, 0.514, 0.966799999999997, 0.2717, 0.1, 0.28, 0.209655172413795, 0.790344827586205, 1, 0, 0

GO



-- ===============================================
SET NOCOUNT OFF
-- ===============================================



-- //////////////////////////////////////////////////////////////
-- //////////////////////////////////////////////////////////////
-- //////////////////////////////////////////////////////////////

